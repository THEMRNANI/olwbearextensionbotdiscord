var xi=Object.create;var Ee=Object.defineProperty;var Ti=Object.getOwnPropertyDescriptor;var Ai=Object.getOwnPropertyNames;var Bi=Object.getPrototypeOf,Ri=Object.prototype.hasOwnProperty;var Ci=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports);var Si=(i,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Ai(t))!Ri.call(i,s)&&s!==e&&Ee(i,s,{get:()=>t[s],enumerable:!(n=Ti(t,s))||n.enumerable});return i};var Ii=(i,t,e)=>(e=i!=null?xi(Bi(i)):{},Si(t||!i||!i.__esModule?Ee(e,"default",{value:i,enumerable:!0}):e,i));var Me=Ci((In,St)=>{"use strict";var V=typeof Reflect=="object"?Reflect:null,xe=V&&typeof V.apply=="function"?V.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)},it;V&&typeof V.ownKeys=="function"?it=V.ownKeys:Object.getOwnPropertySymbols?it=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:it=function(t){return Object.getOwnPropertyNames(t)};function Ni(i){console&&console.warn&&console.warn(i)}var Ae=Number.isNaN||function(t){return t!==t};function _(){_.init.call(this)}St.exports=_;St.exports.once=Li;_.EventEmitter=_;_.prototype._events=void 0;_.prototype._eventsCount=0;_.prototype._maxListeners=void 0;var Te=10;function nt(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(_,"defaultMaxListeners",{enumerable:!0,get:function(){return Te},set:function(i){if(typeof i!="number"||i<0||Ae(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");Te=i}});_.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};_.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Ae(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Be(i){return i._maxListeners===void 0?_.defaultMaxListeners:i._maxListeners}_.prototype.getMaxListeners=function(){return Be(this)};_.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var s=t==="error",r=this._events;if(r!==void 0)s=s&&r.error===void 0;else if(!s)return!1;if(s){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var h=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw h.context=o,h}var l=r[t];if(l===void 0)return!1;if(typeof l=="function")xe(l,this,e);else for(var a=l.length,u=Ne(l,a),n=0;n<a;++n)xe(u[n],this,e);return!0};function Re(i,t,e,n){var s,r,o;if(nt(e),r=i._events,r===void 0?(r=i._events=Object.create(null),i._eventsCount=0):(r.newListener!==void 0&&(i.emit("newListener",t,e.listener?e.listener:e),r=i._events),o=r[t]),o===void 0)o=r[t]=e,++i._eventsCount;else if(typeof o=="function"?o=r[t]=n?[e,o]:[o,e]:n?o.unshift(e):o.push(e),s=Be(i),s>0&&o.length>s&&!o.warned){o.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=i,h.type=t,h.count=o.length,Ni(h)}return i}_.prototype.addListener=function(t,e){return Re(this,t,e,!1)};_.prototype.on=_.prototype.addListener;_.prototype.prependListener=function(t,e){return Re(this,t,e,!0)};function wi(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ce(i,t,e){var n={fired:!1,wrapFn:void 0,target:i,type:t,listener:e},s=wi.bind(n);return s.listener=e,n.wrapFn=s,s}_.prototype.once=function(t,e){return nt(e),this.on(t,Ce(this,t,e)),this};_.prototype.prependOnceListener=function(t,e){return nt(e),this.prependListener(t,Ce(this,t,e)),this};_.prototype.removeListener=function(t,e){var n,s,r,o,h;if(nt(e),s=this._events,s===void 0)return this;if(n=s[t],n===void 0)return this;if(n===e||n.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete s[t],s.removeListener&&this.emit("removeListener",t,n.listener||e));else if(typeof n!="function"){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===e||n[o].listener===e){h=n[o].listener,r=o;break}if(r<0)return this;r===0?n.shift():Mi(n,r),n.length===1&&(s[t]=n[0]),s.removeListener!==void 0&&this.emit("removeListener",t,h||e)}return this};_.prototype.off=_.prototype.removeListener;_.prototype.removeAllListeners=function(t){var e,n,s;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var r=Object.keys(n),o;for(s=0;s<r.length;++s)o=r[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=n[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(s=e.length-1;s>=0;s--)this.removeListener(t,e[s]);return this};function Se(i,t,e){var n=i._events;if(n===void 0)return[];var s=n[t];return s===void 0?[]:typeof s=="function"?e?[s.listener||s]:[s]:e?bi(s):Ne(s,s.length)}_.prototype.listeners=function(t){return Se(this,t,!0)};_.prototype.rawListeners=function(t){return Se(this,t,!1)};_.listenerCount=function(i,t){return typeof i.listenerCount=="function"?i.listenerCount(t):Ie.call(i,t)};_.prototype.listenerCount=Ie;function Ie(i){var t=this._events;if(t!==void 0){var e=t[i];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}_.prototype.eventNames=function(){return this._eventsCount>0?it(this._events):[]};function Ne(i,t){for(var e=new Array(t),n=0;n<t;++n)e[n]=i[n];return e}function Mi(i,t){for(;t+1<i.length;t++)i[t]=i[t+1];i.pop()}function bi(i){for(var t=new Array(i.length),e=0;e<t.length;++e)t[e]=i[e].listener||i[e];return t}function Li(i,t){return new Promise(function(e,n){function s(o){i.removeListener(t,r),n(o)}function r(){typeof i.removeListener=="function"&&i.removeListener("error",s),e([].slice.call(arguments))}we(i,t,r,{once:!0}),t!=="error"&&Di(i,s,{once:!0})})}function Di(i,t,e){typeof i.on=="function"&&we(i,"error",t,e)}function we(i,t,e,n){if(typeof i.on=="function")n.once?i.once(t,e):i.on(t,e);else if(typeof i.addEventListener=="function")i.addEventListener(t,function s(r){n.once&&i.removeEventListener(t,s),e(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}});var A=function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(n.next(u))}catch(c){o(c)}}function l(u){try{a(n.throw(u))}catch(c){o(c)}}function a(u){u.done?r(u.value):s(u.value).then(h,l)}a((n=n.apply(i,t||[])).next())})},Rt=class{constructor(t){this.messageBus=t}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return A(this,void 0,void 0,function*(){let{selection:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return t})}select(t,e){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:t,replace:e})})}deselect(t){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECT",{items:t})})}getName(){return A(this,void 0,void 0,function*(){let{name:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return t})}setName(t){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:t})})}getColor(){return A(this,void 0,void 0,function*(){let{color:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return t})}setColor(t){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:t})})}getSyncView(){return A(this,void 0,void 0,function*(){let{syncView:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return t})}setSyncView(t){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:t})})}getId(){return A(this,void 0,void 0,function*(){let{id:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return t})}getRole(){return A(this,void 0,void 0,function*(){let{role:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return t})}getMetadata(){return A(this,void 0,void 0,function*(){let{metadata:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return t})}setMetadata(t){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:t})})}hasPermission(t){return A(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;let{permissions:n}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return n.indexOf(t)>-1})}getConnectionId(){return A(this,void 0,void 0,function*(){let{connectionId:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return t})}onChange(t){let e=n=>{t(n.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",e)}}},Oe=Rt;var I=function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(n.next(u))}catch(c){o(c)}}function l(u){try{a(n.throw(u))}catch(c){o(c)}}function a(u){u.done?r(u.value):s(u.value).then(h,l)}a((n=n.apply(i,t||[])).next())})},Ct=class{constructor(t){this.messageBus=t}reset(){return I(this,void 0,void 0,function*(){let{transform:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return t})}animateTo(t){return I(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:t})})}animateToBounds(t){return I(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:t})})}getPosition(){return I(this,void 0,void 0,function*(){let{position:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return t})}setPosition(t){return I(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:t})})}getScale(){return I(this,void 0,void 0,function*(){let{scale:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return t})}setScale(t){return I(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:t})})}getWidth(){return I(this,void 0,void 0,function*(){let{width:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return t})}getHeight(){return I(this,void 0,void 0,function*(){let{height:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return t})}transformPoint(t){return I(this,void 0,void 0,function*(){let{point:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:t});return e})}inverseTransformPoint(t){return I(this,void 0,void 0,function*(){let{point:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:t});return e})}},ge=Ct;function ve(i){return typeof i.id=="string"}var Le=Ii(Me());var st,Pi=new Uint8Array(16);function It(){if(!st&&(st=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!st))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return st(Pi)}var O=[];for(let i=0;i<256;++i)O.push((i+256).toString(16).slice(1));function be(i,t=0){return O[i[t+0]]+O[i[t+1]]+O[i[t+2]]+O[i[t+3]]+"-"+O[i[t+4]]+O[i[t+5]]+"-"+O[i[t+6]]+O[i[t+7]]+"-"+O[i[t+8]]+O[i[t+9]]+"-"+O[i[t+10]]+O[i[t+11]]+O[i[t+12]]+O[i[t+13]]+O[i[t+14]]+O[i[t+15]]}var ki=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Nt={randomUUID:ki};function Ui(i,t,e){if(Nt.randomUUID&&!t&&!i)return Nt.randomUUID();i=i||{};let n=i.random||(i.rng||It)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){e=e||0;for(let s=0;s<16;++s)t[e+s]=n[s];return t}return be(n)}var X=Ui;var wt=class extends Le.EventEmitter{constructor(t,e){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=n=>{let s=n.data;if(n.origin===this.targetOrigin&&ve(s)){if(s.id==="OBR_READY"){this.ready=!0;let r=s.data;this.ref=r.ref,this.userId=r.userId}this.emit(s.id,s.data)}},this.send=(n,s,r)=>{var o;if(!this.ref)throw Error("Unable to send message: not ready");(o=window.parent)===null||o===void 0||o.postMessage({id:n,data:s,ref:this.ref,nonce:r},this.targetOrigin)},this.sendAsync=(n,s,r=5e3)=>{let o=`_${X()}`;return this.send(n,s,o),Promise.race([new Promise((h,l)=>{let a=this;function u(d){a.off(`${n}_RESPONSE${o}`,u),a.off(`${n}_ERROR${o}`,c),h(d)}function c(d){a.off(`${n}_RESPONSE${o}`,u),a.off(`${n}_ERROR${o}`,c),l(d)}this.on(`${n}_RESPONSE${o}`,u),this.on(`${n}_ERROR${o}`,c)}),...r>0?[new Promise((h,l)=>window.setTimeout(()=>l(new Error(`Message ${n} took longer than ${r}ms to get a result`)),r))]:[]])},this.roomId=e,this.targetOrigin=t,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}},De=wt;var Pe=function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(n.next(u))}catch(c){o(c)}}function l(u){try{a(n.throw(u))}catch(c){o(c)}}function a(u){u.done?r(u.value):s(u.value).then(h,l)}a((n=n.apply(i,t||[])).next())})},Mt=class{constructor(t){this.messageBus=t}show(t,e){return Pe(this,void 0,void 0,function*(){let{id:n}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:t,variant:e});return n})}close(t){return Pe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:t})})}},ke=Mt;var j=function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(n.next(u))}catch(c){o(c)}}function l(u){try{a(n.throw(u))}catch(c){o(c)}}function a(u){u.done?r(u.value):s(u.value).then(h,l)}a((n=n.apply(i,t||[])).next())})},bt=class{constructor(t){this.messageBus=t}getColor(){return j(this,void 0,void 0,function*(){let{color:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return t})}setColor(t){return j(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:t})})}getStrokeWidth(){return j(this,void 0,void 0,function*(){let{strokeWidth:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return t})}setStrokeWidth(t){return j(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:t})})}getFilled(){return j(this,void 0,void 0,function*(){let{filled:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return t})}setFilled(t){return j(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:t})})}onChange(t){let e=n=>{t(n.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",e)}}},Ue=bt;var B=function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(n.next(u))}catch(c){o(c)}}function l(u){try{a(n.throw(u))}catch(c){o(c)}}function a(u){u.done?r(u.value):s(u.value).then(h,l)}a((n=n.apply(i,t||[])).next())})},Lt=class{constructor(t){this.messageBus=t}getDpi(){return B(this,void 0,void 0,function*(){let{dpi:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return t})}getScale(){return B(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(t){return B(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:t})})}getColor(){return B(this,void 0,void 0,function*(){let{color:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return t})}setColor(t){return B(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:t})})}getOpacity(){return B(this,void 0,void 0,function*(){let{opacity:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return t})}setOpacity(t){return B(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:t})})}getType(){return B(this,void 0,void 0,function*(){let{type:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return t})}setType(t){return B(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:t})})}getLineType(){return B(this,void 0,void 0,function*(){let{lineType:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return t})}setLineType(t){return B(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:t})})}getMeasurement(){return B(this,void 0,void 0,function*(){let{measurement:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return t})}setMeasurement(t){return B(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:t})})}snapPosition(t,e,n,s){return B(this,void 0,void 0,function*(){let{position:r}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:t,snappingSensitivity:e,useCorners:n,useCenter:s});return r})}getDistance(t,e){return B(this,void 0,void 0,function*(){let{distance:n}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:t,to:e});return n})}onChange(t){let e=n=>{t(n.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",e)}}},Ge=Lt;var rt=function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(n.next(u))}catch(c){o(c)}}function l(u){try{a(n.throw(u))}catch(c){o(c)}}function a(u){u.done?r(u.value):s(u.value).then(h,l)}a((n=n.apply(i,t||[])).next())})},Dt=class{constructor(t){this.messageBus=t}undo(){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return rt(this,void 0,void 0,function*(){let{canUndo:t}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return t})}canRedo(){return rt(this,void 0,void 0,function*(){let{canRedo:t}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return t})}},Ve=Dt;function g(i){for(var t=arguments.length,e=Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];if(0)var s,r;throw Error("[Immer] minified error nr: "+i+(e.length?" "+e.map((function(o){return"'"+o+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function U(i){return!!i&&!!i[C]}function L(i){var t;return!!i&&((function(e){if(!e||typeof e!="object")return!1;var n=Object.getPrototypeOf(e);if(n===null)return!0;var s=Object.hasOwnProperty.call(n,"constructor")&&n.constructor;return s===Object||typeof s=="function"&&Function.toString.call(s)===zi})(i)||Array.isArray(i)||!!i[q]||!!(!((t=i.constructor)===null||t===void 0)&&t[q])||lt(i)||ht(i))}function W(i,t,e){e===void 0&&(e=!1),D(i)===0?(e?Object.keys:Zt)(i).forEach((function(n){e&&typeof n=="symbol"||t(n,i[n],i)})):i.forEach((function(n,s){return t(s,n,i)}))}function D(i){var t=i[C];return t?t.i>3?t.i-4:t.i:Array.isArray(i)?1:lt(i)?2:ht(i)?3:0}function J(i,t){return D(i)===2?i.has(t):Object.prototype.hasOwnProperty.call(i,t)}function ot(i,t){return D(i)===2?i.get(t):i[t]}function $e(i,t,e){var n=D(i);n===2?i.set(t,e):n===3?i.add(e):i[t]=e}function Gi(i,t){return i===t?i!==0||1/i==1/t:i!=i&&t!=t}function lt(i){return Fi&&i instanceof Map}function ht(i){return Yi&&i instanceof Set}function k(i){return i.o||i.t}function Yt(i){if(Array.isArray(i))return Array.prototype.slice.call(i);var t=Ki(i);delete t[C];for(var e=Zt(t),n=0;n<e.length;n++){var s=e[n],r=t[s];r.writable===!1&&(r.writable=!0,r.configurable=!0),(r.get||r.set)&&(t[s]={configurable:!0,writable:!0,enumerable:r.enumerable,value:i[s]})}return Object.create(Object.getPrototypeOf(i),t)}function zt(i,t){return t===void 0&&(t=!1),Kt(i)||U(i)||!L(i)||(D(i)>1&&(i.set=i.add=i.clear=i.delete=Vi),Object.freeze(i),t&&W(i,(function(e,n){return zt(n,!0)}),!0)),i}function Vi(){g(2)}function Kt(i){return i==null||typeof i!="object"||Object.isFrozen(i)}function N(i){var t=Ht[i];return t||g(18,i),t}function ji(i,t){Ht[i]||(Ht[i]=t)}function je(){return Q}function Pt(i,t){t&&(N("Patches"),i.u=[],i.s=[],i.v=t)}function ut(i){Vt(i),i.p.forEach(Wi),i.p=null}function Vt(i){i===Q&&(Q=i.l)}function We(i){return Q={p:[],l:Q,h:i,m:!0,_:0}}function Wi(i){var t=i[C];t.i===0||t.i===1?t.j():t.g=!0}function kt(i,t){t._=t.p.length;var e=t.p[0],n=i!==void 0&&i!==e;return t.h.O||N("ES5").S(t,i,n),n?(e[C].P&&(ut(t),g(4)),L(i)&&(i=at(t,i),t.l||ct(t,i)),t.u&&N("Patches").M(e[C].t,i,t.u,t.s)):i=at(t,e,[]),ut(t),t.u&&t.v(t.u,t.s),i!==Xt?i:void 0}function at(i,t,e){if(Kt(t))return t;var n=t[C];if(!n)return W(t,(function(h,l){return He(i,n,t,h,l,e)}),!0),t;if(n.A!==i)return t;if(!n.P)return ct(i,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var s=n.i===4||n.i===5?n.o=Yt(n.k):n.o,r=s,o=!1;n.i===3&&(r=new Set(s),s.clear(),o=!0),W(r,(function(h,l){return He(i,n,s,h,l,e,o)})),ct(i,s,!1),e&&i.u&&N("Patches").N(n,e,i.u,i.s)}return n.o}function He(i,t,e,n,s,r,o){if(U(s)){var h=at(i,s,r&&t&&t.i!==3&&!J(t.R,n)?r.concat(n):void 0);if($e(e,n,h),!U(h))return;i.m=!1}else o&&e.add(s);if(L(s)&&!Kt(s)){if(!i.h.D&&i._<1)return;at(i,s),t&&t.A.l||ct(i,s)}}function ct(i,t,e){e===void 0&&(e=!1),!i.l&&i.h.D&&i.m&&zt(t,e)}function Ut(i,t){var e=i[C];return(e?k(e):i)[t]}function Fe(i,t){if(t in i)for(var e=Object.getPrototypeOf(i);e;){var n=Object.getOwnPropertyDescriptor(e,t);if(n)return n;e=Object.getPrototypeOf(e)}}function jt(i){i.P||(i.P=!0,i.l&&jt(i.l))}function Gt(i){i.o||(i.o=Yt(i.t))}function Wt(i,t,e){var n=lt(t)?N("MapSet").F(t,e):ht(t)?N("MapSet").T(t,e):i.O?(function(s,r){var o=Array.isArray(s),h={i:o?1:0,A:r?r.A:je(),P:!1,I:!1,R:{},l:r,t:s,k:null,o:null,j:null,C:!1},l=h,a=Ft;o&&(l=[h],a=Z);var u=Proxy.revocable(l,a),c=u.revoke,d=u.proxy;return h.k=d,h.j=c,d})(t,e):N("ES5").J(t,e);return(e?e.A:je()).p.push(n),n}function Hi(i){return U(i)||g(22,i),(function t(e){if(!L(e))return e;var n,s=e[C],r=D(e);if(s){if(!s.P&&(s.i<4||!N("ES5").K(s)))return s.t;s.I=!0,n=Ye(e,r),s.I=!1}else n=Ye(e,r);return W(n,(function(o,h){s&&ot(s.t,o)===h||$e(n,o,t(h))})),r===3?new Set(n):n})(i)}function Ye(i,t){switch(t){case 2:return new Map(i);case 3:return Array.from(i)}return Yt(i)}function H(){function i(n){if(!L(n))return n;if(Array.isArray(n))return n.map(i);if(lt(n))return new Map(Array.from(n.entries()).map((function(o){return[o[0],i(o[1])]})));if(ht(n))return new Set(Array.from(n).map(i));var s=Object.create(Object.getPrototypeOf(n));for(var r in n)s[r]=i(n[r]);return J(n,q)&&(s[q]=n[q]),s}function t(n){return U(n)?i(n):n}var e="add";ji("Patches",{$:function(n,s){return s.forEach((function(r){for(var o=r.path,h=r.op,l=n,a=0;a<o.length-1;a++){var u=D(l),c=o[a];typeof c!="string"&&typeof c!="number"&&(c=""+c),u!==0&&u!==1||c!=="__proto__"&&c!=="constructor"||g(24),typeof l=="function"&&c==="prototype"&&g(24),typeof(l=ot(l,c))!="object"&&g(15,o.join("/"))}var d=D(l),f=i(r.value),p=o[o.length-1];switch(h){case"replace":switch(d){case 2:return l.set(p,f);case 3:g(16);default:return l[p]=f}case e:switch(d){case 1:return p==="-"?l.push(f):l.splice(p,0,f);case 2:return l.set(p,f);case 3:return l.add(f);default:return l[p]=f}case"remove":switch(d){case 1:return l.splice(p,1);case 2:return l.delete(p);case 3:return l.delete(r.value);default:return delete l[p]}default:g(17,h)}})),n},N:function(n,s,r,o){switch(n.i){case 0:case 4:case 2:return(function(h,l,a,u){var c=h.t,d=h.o;W(h.R,(function(f,p){var y=ot(c,f),v=ot(d,f),x=p?J(c,f)?"replace":e:"remove";if(y!==v||x!=="replace"){var T=l.concat(f);a.push(x==="remove"?{op:x,path:T}:{op:x,path:T,value:v}),u.push(x===e?{op:"remove",path:T}:x==="remove"?{op:e,path:T,value:t(y)}:{op:"replace",path:T,value:t(y)})}}))})(n,s,r,o);case 5:case 1:return(function(h,l,a,u){var c=h.t,d=h.R,f=h.o;if(f.length<c.length){var p=[f,c];c=p[0],f=p[1];var y=[u,a];a=y[0],u=y[1]}for(var v=0;v<c.length;v++)if(d[v]&&f[v]!==c[v]){var x=l.concat([v]);a.push({op:"replace",path:x,value:t(f[v])}),u.push({op:"replace",path:x,value:t(c[v])})}for(var T=c.length;T<f.length;T++){var b=l.concat([T]);a.push({op:e,path:b,value:t(f[T])})}c.length<f.length&&u.push({op:"replace",path:l.concat(["length"]),value:c.length})})(n,s,r,o);case 3:return(function(h,l,a,u){var c=h.t,d=h.o,f=0;c.forEach((function(p){if(!d.has(p)){var y=l.concat([f]);a.push({op:"remove",path:y,value:p}),u.unshift({op:e,path:y,value:p})}f++})),f=0,d.forEach((function(p){if(!c.has(p)){var y=l.concat([f]);a.push({op:e,path:y,value:p}),u.unshift({op:"remove",path:y,value:p})}f++}))})(n,s,r,o)}},M:function(n,s,r,o){r.push({op:"replace",path:[],value:s===Xt?void 0:s}),o.push({op:"replace",path:[],value:n})}})}var ze,Q,$t=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Fi=typeof Map<"u",Yi=typeof Set<"u",Ke=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Xt=$t?Symbol.for("immer-nothing"):((ze={})["immer-nothing"]=!0,ze),q=$t?Symbol.for("immer-draftable"):"__$immer_draftable",C=$t?Symbol.for("immer-state"):"__$immer_state";var zi=""+Object.prototype.constructor,Zt=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:Object.getOwnPropertyNames,Ki=Object.getOwnPropertyDescriptors||function(i){var t={};return Zt(i).forEach((function(e){t[e]=Object.getOwnPropertyDescriptor(i,e)})),t},Ht={},Ft={get:function(i,t){if(t===C)return i;var e=k(i);if(!J(e,t))return(function(s,r,o){var h,l=Fe(r,o);return l?"value"in l?l.value:(h=l.get)===null||h===void 0?void 0:h.call(s.k):void 0})(i,e,t);var n=e[t];return i.I||!L(n)?n:n===Ut(i.t,t)?(Gt(i),i.o[t]=Wt(i.A.h,n,i)):n},has:function(i,t){return t in k(i)},ownKeys:function(i){return Reflect.ownKeys(k(i))},set:function(i,t,e){var n=Fe(k(i),t);if(n?.set)return n.set.call(i.k,e),!0;if(!i.P){var s=Ut(k(i),t),r=s?.[C];if(r&&r.t===e)return i.o[t]=e,i.R[t]=!1,!0;if(Gi(e,s)&&(e!==void 0||J(i.t,t)))return!0;Gt(i),jt(i)}return i.o[t]===e&&(e!==void 0||t in i.o)||Number.isNaN(e)&&Number.isNaN(i.o[t])||(i.o[t]=e,i.R[t]=!0),!0},deleteProperty:function(i,t){return Ut(i.t,t)!==void 0||t in i.t?(i.R[t]=!1,Gt(i),jt(i)):delete i.R[t],i.o&&delete i.o[t],!0},getOwnPropertyDescriptor:function(i,t){var e=k(i),n=Reflect.getOwnPropertyDescriptor(e,t);return n&&{writable:!0,configurable:i.i!==1||t!=="length",enumerable:n.enumerable,value:e[t]}},defineProperty:function(){g(11)},getPrototypeOf:function(i){return Object.getPrototypeOf(i.t)},setPrototypeOf:function(){g(12)}},Z={};W(Ft,(function(i,t){Z[i]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),Z.deleteProperty=function(i,t){return Z.set.call(this,i,t,void 0)},Z.set=function(i,t,e){return Ft.set.call(this,i[0],t,e,i[0])};var $i=(function(){function i(e){var n=this;this.O=Ke,this.D=!0,this.produce=function(s,r,o){if(typeof s=="function"&&typeof r!="function"){var h=r;r=s;var l=n;return function(y){var v=this;y===void 0&&(y=h);for(var x=arguments.length,T=Array(x>1?x-1:0),b=1;b<x;b++)T[b-1]=arguments[b];return l.produce(y,(function(Bt){var et;return(et=r).call.apply(et,[v,Bt].concat(T))}))}}var a;if(typeof r!="function"&&g(6),o!==void 0&&typeof o!="function"&&g(7),L(s)){var u=We(n),c=Wt(n,s,void 0),d=!0;try{a=r(c),d=!1}finally{d?ut(u):Vt(u)}return typeof Promise<"u"&&a instanceof Promise?a.then((function(y){return Pt(u,o),kt(y,u)}),(function(y){throw ut(u),y})):(Pt(u,o),kt(a,u))}if(!s||typeof s!="object"){if((a=r(s))===void 0&&(a=s),a===Xt&&(a=void 0),n.D&&zt(a,!0),o){var f=[],p=[];N("Patches").M(s,a,f,p),o(f,p)}return a}g(21,s)},this.produceWithPatches=function(s,r){if(typeof s=="function")return function(a){for(var u=arguments.length,c=Array(u>1?u-1:0),d=1;d<u;d++)c[d-1]=arguments[d];return n.produceWithPatches(a,(function(f){return s.apply(void 0,[f].concat(c))}))};var o,h,l=n.produce(s,r,(function(a,u){o=a,h=u}));return typeof Promise<"u"&&l instanceof Promise?l.then((function(a){return[a,o,h]})):[l,o,h]},typeof e?.useProxies=="boolean"&&this.setUseProxies(e.useProxies),typeof e?.autoFreeze=="boolean"&&this.setAutoFreeze(e.autoFreeze)}var t=i.prototype;return t.createDraft=function(e){L(e)||g(8),U(e)&&(e=Hi(e));var n=We(this),s=Wt(this,e,void 0);return s[C].C=!0,Vt(n),s},t.finishDraft=function(e,n){var s=e&&e[C],r=s.A;return Pt(r,n),kt(void 0,r)},t.setAutoFreeze=function(e){this.D=e},t.setUseProxies=function(e){e&&!Ke&&g(20),this.O=e},t.applyPatches=function(e,n){var s;for(s=n.length-1;s>=0;s--){var r=n[s];if(r.path.length===0&&r.op==="replace"){e=r.value;break}}s>-1&&(n=n.slice(s+1));var o=N("Patches").$;return U(e)?o(e,n):this.produce(e,(function(h){return o(h,n)}))},i})(),S=new $i,zn=S.produce,F=S.produceWithPatches.bind(S),Kn=S.setAutoFreeze.bind(S),$n=S.setUseProxies.bind(S),Xn=S.applyPatches.bind(S),Zn=S.createDraft.bind(S),qn=S.finishDraft.bind(S);var Y=function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(n.next(u))}catch(c){o(c)}}function l(u){try{a(n.throw(u))}catch(c){o(c)}}function a(u){u.done?r(u.value):s(u.value).then(h,l)}a((n=n.apply(i,t||[])).next())})};H();var qt=class{constructor(t){this.messageBus=t}getItems(t){return Y(this,void 0,void 0,function*(){if(Array.isArray(t)){let{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:t});return e}else if(t){let{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return e.filter(t)}else{let{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return e}})}isItemArray(t){return Array.isArray(t)&&t.every(e=>typeof e!="string")}updateItems(t,e,n=!0){return Y(this,void 0,void 0,function*(){let s;this.isItemArray(t)?s=t:s=yield this.getItems(t);let[r,o]=F(s,e),h=r.map(a=>({id:a.id,type:a.type}));for(let a of o){let[u,c]=a.path;typeof u=="number"&&typeof c=="string"&&(h[u][c]=r[u][c])}let l=h.filter(a=>Object.keys(a).length>2);l.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:l,updateAttachments:n}))})}addItems(t){return Y(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:t})})}deleteItems(t){return Y(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:t})})}getItemAttachments(t){return Y(this,void 0,void 0,function*(){let{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:t});return e})}getItemBounds(t){return Y(this,void 0,void 0,function*(){let{bounds:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:t});return e})}onChange(t){let e=n=>{t(n.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",e)}}},Xe=qt;var z=function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(n.next(u))}catch(c){o(c)}}function l(u){try{a(n.throw(u))}catch(c){o(c)}}function a(u){u.done?r(u.value):s(u.value).then(h,l)}a((n=n.apply(i,t||[])).next())})};H();var Jt=class{constructor(t){this.messageBus=t}getItems(t){return z(this,void 0,void 0,function*(){if(Array.isArray(t)){let{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:t});return e}else if(t){let{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return e.filter(t)}else{let{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return e}})}isItemArray(t){return Array.isArray(t)&&t.every(e=>typeof e!="string")}updateItems(t,e,n,s=!0){return z(this,void 0,void 0,function*(){let r;this.isItemArray(t)?r=t:r=yield this.getItems(t);let[o,h]=F(r,e),l=o.map(u=>({id:u.id,type:u.type}));for(let u of h){let[c,d]=u.path;typeof c=="number"&&typeof d=="string"&&(l[c][d]=o[c][d])}let a=l.filter(u=>Object.keys(u).length>2);a.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:a,fastUpdate:n,updateAttachments:s}))})}addItems(t){return z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:t})})}deleteItems(t){return z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:t})})}getItemAttachments(t){return z(this,void 0,void 0,function*(){let{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:t});return e})}getItemBounds(t){return z(this,void 0,void 0,function*(){let{bounds:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:t});return e})}onChange(t){let e=n=>{t(n.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",e)}}},Ze=Jt;var Qt=function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(n.next(u))}catch(c){o(c)}}function l(u){try{a(n.throw(u))}catch(c){o(c)}}function a(u){u.done?r(u.value):s(u.value).then(h,l)}a((n=n.apply(i,t||[])).next())})},te=class{constructor(t){this.messageBus=t,this.grid=new Ge(t),this.fog=new Ue(t),this.history=new Ve(t),this.items=new Xe(t),this.local=new Ze(t)}isReady(){return Qt(this,void 0,void 0,function*(){let{ready:t}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return t})}onReadyChange(t){let e=n=>{t(n.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",e)}}getMetadata(){return Qt(this,void 0,void 0,function*(){let{metadata:t}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return t})}setMetadata(t){return Qt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:t})})}onMetadataChange(t){let e=n=>{t(n.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",e)}}},qe=te;function Je(i){return i.startsWith("http")?i:`${window.location.origin}${i}`}function P(i){return i.map(t=>Object.assign(Object.assign({},t),{icon:Je(t.icon)}))}function K(i){return Object.assign(Object.assign({},i),{url:Je(i.url)})}var Qe=function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(n.next(u))}catch(c){o(c)}}function l(u){try{a(n.throw(u))}catch(c){o(c)}}function a(u){u.done?r(u.value):s(u.value).then(h,l)}a((n=n.apply(i,t||[])).next())})},ee=class{constructor(t){this.contextMenus={},this.handleClick=e=>{var n;let s=this.contextMenus[e.id];s&&((n=s.onClick)===null||n===void 0||n.call(s,e.context,e.elementId))},this.messageBus=t,t.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(t){return Qe(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:t.id,shortcut:t.shortcut,icons:P(t.icons),embed:t.embed&&K(t.embed)}),this.contextMenus[t.id]=t})}remove(t){return Qe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:t}),delete this.contextMenus[t]})}},ti=ee;var w=function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(n.next(u))}catch(c){o(c)}}function l(u){try{a(n.throw(u))}catch(c){o(c)}}function a(u){u.done?r(u.value):s(u.value).then(h,l)}a((n=n.apply(i,t||[])).next())})},ie=class{constructor(t){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=e=>{let n=this.tools[e.id];if(n)if(n.onClick){let s=n.onClick(e.context,e.elementId);Promise.resolve(s).then(r=>{r&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:e.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:e.id})},this.handleToolActionClick=e=>{var n;let s=this.toolActions[e.id];s&&((n=s.onClick)===null||n===void 0||n.call(s,e.context,e.elementId))},this.handleToolModeClick=e=>{let n=this.toolModes[e.id];if(n)if(n.onClick){let s=n.onClick(e.context,e.elementId);Promise.resolve(s).then(r=>{r&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:e.context.activeTool,modeId:e.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:e.context.activeTool,modeId:e.id})},this.handleToolModeToolClick=e=>{let n=this.toolModes[e.id];if(n)if(n.onToolClick){let s=n.onToolClick(e.context,e.event);Promise.resolve(s).then(r=>{r&&e.event.target&&!e.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})})}else e.event.target&&!e.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})},this.handleToolModeToolDoubleClick=e=>{let n=this.toolModes[e.id];if(n)if(n.onToolDoubleClick){let s=n.onToolDoubleClick(e.context,e.event);Promise.resolve(s).then(r=>{r&&e.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})})}else e.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})},this.handleToolModeToolDown=e=>{var n;let s=this.toolModes[e.id];s&&((n=s.onToolDown)===null||n===void 0||n.call(s,e.context,e.event))},this.handleToolModeToolMove=e=>{var n;let s=this.toolModes[e.id];s&&((n=s.onToolMove)===null||n===void 0||n.call(s,e.context,e.event))},this.handleToolModeToolUp=e=>{var n;let s=this.toolModes[e.id];s&&((n=s.onToolUp)===null||n===void 0||n.call(s,e.context,e.event))},this.handleToolModeToolDragStart=e=>{var n;let s=this.toolModes[e.id];s&&((n=s.onToolDragStart)===null||n===void 0||n.call(s,e.context,e.event))},this.handleToolModeToolDragMove=e=>{var n;let s=this.toolModes[e.id];s&&((n=s.onToolDragMove)===null||n===void 0||n.call(s,e.context,e.event))},this.handleToolModeToolDragEnd=e=>{var n;let s=this.toolModes[e.id];s&&((n=s.onToolDragEnd)===null||n===void 0||n.call(s,e.context,e.event))},this.handleToolModeToolDragCancel=e=>{var n;let s=this.toolModes[e.id];s&&((n=s.onToolDragCancel)===null||n===void 0||n.call(s,e.context,e.event))},this.handleToolModeKeyDown=e=>{var n;let s=this.toolModes[e.id];s&&((n=s.onKeyDown)===null||n===void 0||n.call(s,e.context,e.event))},this.handleToolModeKeyUp=e=>{var n;let s=this.toolModes[e.id];s&&((n=s.onKeyUp)===null||n===void 0||n.call(s,e.context,e.event))},this.handleToolModeActivate=e=>{var n;let s=this.toolModes[e.id];s&&((n=s.onActivate)===null||n===void 0||n.call(s,e.context))},this.handleToolModeDeactivate=e=>{var n;let s=this.toolModes[e.id];s&&((n=s.onDeactivate)===null||n===void 0||n.call(s,e.context))},this.messageBus=t,t.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),t.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),t.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),t.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),t.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),t.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),t.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),t.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),t.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(t){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:t.id,shortcut:t.shortcut,defaultMode:t.defaultMode,defaultMetadata:t.defaultMetadata,icons:P(t.icons),disabled:t.disabled}),this.tools[t.id]=t})}remove(t){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:t}),delete this.tools[t]})}activateTool(t){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:t})})}getMetadata(t){return w(this,void 0,void 0,function*(){let{metadata:e}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:t});return e})}setMetadata(t,e){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:t,update:e})})}createAction(t){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:t.id,shortcut:t.shortcut,icons:P(t.icons),disabled:t.disabled}),this.toolActions[t.id]=t})}removeAction(t){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:t}),delete this.tools[t]})}createMode(t){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:t.id,shortcut:t.shortcut,icons:P(t.icons),preventDrag:t.preventDrag,disabled:t.disabled,cursors:t.cursors}),this.toolModes[t.id]=t})}removeMode(t){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:t}),delete this.tools[t]})}activateMode(t,e){return w(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:t,modeId:e})})}},ei=ie;var $=function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(n.next(u))}catch(c){o(c)}}function l(u){try{a(n.throw(u))}catch(c){o(c)}}function a(u){u.done?r(u.value):s(u.value).then(h,l)}a((n=n.apply(i,t||[])).next())})},ne=class{constructor(t){this.messageBus=t}open(t){return $(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},K(t)))})}close(t){return $(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:t})})}getWidth(t){return $(this,void 0,void 0,function*(){let{width:e}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:t});return e})}setWidth(t,e){return $(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:t,width:e})})}getHeight(t){return $(this,void 0,void 0,function*(){let{height:e}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:t});return e})}setHeight(t,e){return $(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:t,height:e})})}},ii=ne;var ni=function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(n.next(u))}catch(c){o(c)}}function l(u){try{a(n.throw(u))}catch(c){o(c)}}function a(u){u.done?r(u.value):s(u.value).then(h,l)}a((n=n.apply(i,t||[])).next())})},se=class{constructor(t){this.messageBus=t}open(t){return ni(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},K(t)))})}close(t){return ni(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:t})})}},si=se;var R=function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(n.next(u))}catch(c){o(c)}}function l(u){try{a(n.throw(u))}catch(c){o(c)}}function a(u){u.done?r(u.value):s(u.value).then(h,l)}a((n=n.apply(i,t||[])).next())})},re=class{constructor(t){this.messageBus=t}getWidth(){return R(this,void 0,void 0,function*(){let{width:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return t})}setWidth(t){return R(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:t})})}getHeight(){return R(this,void 0,void 0,function*(){let{height:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return t})}setHeight(t){return R(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:t})})}getBadgeText(){return R(this,void 0,void 0,function*(){let{badgeText:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return t})}setBadgeText(t){return R(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:t})})}getBadgeBackgroundColor(){return R(this,void 0,void 0,function*(){let{badgeBackgroundColor:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return t})}setBadgeBackgroundColor(t){return R(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:t})})}getIcon(){return R(this,void 0,void 0,function*(){let{icon:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return t})}setIcon(t){return R(this,void 0,void 0,function*(){let e=P([{icon:t}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:e[0].icon})})}getTitle(){return R(this,void 0,void 0,function*(){let{title:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return t})}setTitle(t){return R(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:t})})}isOpen(){return R(this,void 0,void 0,function*(){let{isOpen:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return t})}open(){return R(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return R(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(t){let e=n=>{t(n.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",e)}}},ri=re;var Xi=function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(n.next(u))}catch(c){o(c)}}function l(u){try{a(n.throw(u))}catch(c){o(c)}}function a(u){u.done?r(u.value):s(u.value).then(h,l)}a((n=n.apply(i,t||[])).next())})};H();var oe=class{constructor(t){this.messageBus=t}startItemInteraction(t,e=!0){return Xi(this,void 0,void 0,function*(){let{id:n}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:t,updateAttachments:e}),s=t;return[h=>{let[l,a]=F(s,h);return s=l,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:n,patches:a}),l},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:n})}]})}},oi=oe;var Zi=function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(n.next(u))}catch(c){o(c)}}function l(u){try{a(n.throw(u))}catch(c){o(c)}}function a(u){u.done?r(u.value):s(u.value).then(h,l)}a((n=n.apply(i,t||[])).next())})},ue=class{constructor(t){this.messageBus=t}getPlayers(){return Zi(this,void 0,void 0,function*(){let{players:t}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return t})}onChange(t){let e=n=>{t(n.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",e)}}},ui=ue;var ae=function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(n.next(u))}catch(c){o(c)}}function l(u){try{a(n.throw(u))}catch(c){o(c)}}function a(u){u.done?r(u.value):s(u.value).then(h,l)}a((n=n.apply(i,t||[])).next())})},ce=class{constructor(t){this.messageBus=t}get id(){return this.messageBus.roomId}getPermissions(){return ae(this,void 0,void 0,function*(){let{permissions:t}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return t})}getMetadata(){return ae(this,void 0,void 0,function*(){let{metadata:t}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return t})}setMetadata(t){return ae(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:t})})}onMetadataChange(t){let e=n=>{t(n.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",e)}}onPermissionsChange(t){let e=n=>{t(n.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",e)}}},ai=ce;var qi=function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(n.next(u))}catch(c){o(c)}}function l(u){try{a(n.throw(u))}catch(c){o(c)}}function a(u){u.done?r(u.value):s(u.value).then(h,l)}a((n=n.apply(i,t||[])).next())})},le=class{constructor(t){this.messageBus=t}getTheme(){return qi(this,void 0,void 0,function*(){let{theme:t}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return t})}onChange(t){let e=n=>{t(n.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",e)}}},ci=le;var dt=function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(n.next(u))}catch(c){o(c)}}function l(u){try{a(n.throw(u))}catch(c){o(c)}}function a(u){u.done?r(u.value):s(u.value).then(h,l)}a((n=n.apply(i,t||[])).next())})},he=class{constructor(t){this.messageBus=t}uploadImages(t,e){return dt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_IMAGES",{images:t,typeHint:e})})}uploadScenes(t,e){return dt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_SCENES",{scenes:t,disableShowScenes:e})})}downloadImages(t,e,n){return dt(this,void 0,void 0,function*(){let{images:s}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_IMAGES",{multiple:t,defaultSearch:e,typeHint:n},-1);return s})}downloadScenes(t,e){return dt(this,void 0,void 0,function*(){let{scenes:n}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_SCENES",{multiple:t,defaultSearch:e},-1);return n})}},li=he;var Ji=function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(n.next(u))}catch(c){o(c)}}function l(u){try{a(n.throw(u))}catch(c){o(c)}}function a(u){u.done?r(u.value):s(u.value).then(h,l)}a((n=n.apply(i,t||[])).next())})},de=class{constructor(t){this.messageBus=t}sendMessage(t,e,n){return Ji(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_BROADCAST_SEND_MESSAGE",{channel:t,data:e,options:n})})}onMessage(t,e){return this.messageBus.send("OBR_BROADCAST_SUBSCRIBE",{channel:t}),this.messageBus.on(`OBR_BROADCAST_MESSAGE_${t}`,e),()=>{this.messageBus.send("OBR_BROADCAST_UNSUBSCRIBE",{channel:t}),this.messageBus.off(`OBR_BROADCAST_MESSAGE_${t}`,e)}}},hi=de;var m=class{constructor(t){this._item={createdUserId:t.id,id:X(),name:"Item",zIndex:Date.now(),lastModified:new Date().toISOString(),lastModifiedUserId:t.id,locked:!1,metadata:{},position:{x:0,y:0},rotation:0,scale:{x:1,y:1},type:"ITEM",visible:!0,layer:"POPOVER"}}createdUserId(t){return this._item.createdUserId=t,this.self()}id(t){return this._item.id=t,this.self()}name(t){return this._item.name=t,this.self()}description(t){return this._item.description=t,this.self()}lastModified(t){return this._item.lastModified=t,this.self()}zIndex(t){return this._item.zIndex=t,this.self()}lastModifiedUserId(t){return this._item.lastModifiedUserId=t,this.self()}locked(t){return this._item.locked=t,this.self()}metadata(t){return this._item.metadata=t,this.self()}position(t){return this._item.position=t,this.self()}rotation(t){return this._item.rotation=t,this.self()}scale(t){return this._item.scale=t,this.self()}visible(t){return this._item.visible=t,this.self()}attachedTo(t){return this._item.attachedTo=t,this.self()}layer(t){return this._item.layer=t,this.self()}disableHit(t){return this._item.disableHit=t,this.self()}disableAutoZIndex(t){return this._item.disableAutoZIndex=t,this.self()}disableAttachmentBehavior(t){return this._item.disableAttachmentBehavior=t,this.self()}self(){return this}};var ft=class extends m{constructor(t){super(t),this._points=[],this._style={fillColor:"black",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:5,strokeDash:[],tension:.5},this._item.name="Curve",this._item.layer="DRAWING"}points(t){return this._points=t,this.self()}style(t){return this._style=t,this.self()}fillColor(t){return this._style.fillColor=t,this.self()}fillOpacity(t){return this._style.fillOpacity=t,this.self()}strokeColor(t){return this._style.strokeColor=t,this.self()}strokeOpacity(t){return this._style.strokeOpacity=t,this.self()}strokeWidth(t){return this._style.strokeWidth=t,this.self()}strokeDash(t){return this._style.strokeDash=t,this.self()}tension(t){return this._style.tension=t,this.self()}closed(t){return this._style.closed=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"CURVE",points:this._points,style:this._style})}};var _t=class extends m{constructor(t,e,n){super(t),this._image=e,this._grid=n,this._item.name="Image",this._text={richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:8,fontFamily:"Roboto",fontSize:24,fontWeight:400,textAlign:"CENTER",textAlignVertical:"BOTTOM",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"PLAIN",width:"AUTO",height:"AUTO"},this._textItemType="LABEL"}text(t){return this._text=t,this.self()}textItemType(t){return this._textItemType=t,this.self()}textWidth(t){return this._text.width=t,this.self()}textHeight(t){return this._text.height=t,this.self()}richText(t){return this._text.richText=t,this.self()}plainText(t){return this._text.plainText=t,this.self()}textType(t){return this._text.type=t,this.self()}textPadding(t){return this._text.style.padding=t,this.self()}fontFamily(t){return this._text.style.fontFamily=t,this.self()}fontSize(t){return this._text.style.fontSize=t,this.self()}fontWeight(t){return this._text.style.fontWeight=t,this.self()}textAlign(t){return this._text.style.textAlign=t,this.self()}textAlignVertical(t){return this._text.style.textAlignVertical=t,this.self()}textFillColor(t){return this._text.style.fillColor=t,this.self()}textFillOpacity(t){return this._text.style.fillOpacity=t,this.self()}textStrokeColor(t){return this._text.style.strokeColor=t,this.self()}textStrokeOpacity(t){return this._text.style.strokeOpacity=t,this.self()}textStrokeWidth(t){return this._text.style.strokeWidth=t,this.self()}textLineHeight(t){return this._text.style.lineHeight=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"IMAGE",image:this._image,grid:this._grid,text:this._text,textItemType:this._textItemType})}};var pt=class extends m{constructor(t){super(t),this._text={richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:8,fontFamily:"Roboto",fontSize:16,fontWeight:400,textAlign:"CENTER",textAlignVertical:"MIDDLE",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"PLAIN",width:"AUTO",height:"AUTO"},this._style={backgroundColor:"#3D4051",backgroundOpacity:1,cornerRadius:8,pointerDirection:"DOWN",pointerWidth:4,pointerHeight:4},this._item.layer="TEXT",this._item.name="Label"}text(t){return this._text=t,this.self()}width(t){return this._text.width=t,this.self()}height(t){return this._text.height=t,this.self()}plainText(t){return this._text.plainText=t,this.self()}padding(t){return this._text.style.padding=t,this.self()}fontFamily(t){return this._text.style.fontFamily=t,this.self()}fontSize(t){return this._text.style.fontSize=t,this.self()}fontWeight(t){return this._text.style.fontWeight=t,this.self()}textAlign(t){return this._text.style.textAlign=t,this.self()}textAlignVertical(t){return this._text.style.textAlignVertical=t,this.self()}fillColor(t){return this._text.style.fillColor=t,this.self()}fillOpacity(t){return this._text.style.fillOpacity=t,this.self()}strokeColor(t){return this._text.style.strokeColor=t,this.self()}strokeOpacity(t){return this._text.style.strokeOpacity=t,this.self()}strokeWidth(t){return this._text.style.strokeWidth=t,this.self()}lineHeight(t){return this._text.style.lineHeight=t,this.self()}style(t){return this._style=t,this.self()}backgroundColor(t){return this._style.backgroundColor=t,this.self()}backgroundOpacity(t){return this._style.backgroundOpacity=t,this.self()}cornerRadius(t){return this._style.cornerRadius=t,this.self()}pointerWidth(t){return this._style.pointerWidth=t,this.self()}pointerHeight(t){return this._style.pointerHeight=t,this.self()}pointerDirection(t){return this._style.pointerDirection=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"LABEL",text:this._text,style:this._style})}};var yt=class extends m{constructor(t){super(t),this._style={strokeColor:"black",strokeOpacity:1,strokeWidth:5,strokeDash:[]},this._startPosition={x:0,y:0},this._endPosition={x:0,y:0},this._item.layer="DRAWING",this._item.name="Line"}style(t){return this._style=t,this.self()}strokeColor(t){return this._style.strokeColor=t,this.self()}strokeOpacity(t){return this._style.strokeOpacity=t,this.self()}strokeWidth(t){return this._style.strokeWidth=t,this.self()}strokeDash(t){return this._style.strokeDash=t,this.self()}startPosition(t){return this._startPosition=t,this.self()}endPosition(t){return this._endPosition=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"LINE",startPosition:this._startPosition,endPosition:this._endPosition,style:this._style})}};var mt=class extends m{constructor(t){super(t),this._color="black",this._radius=20,this._item.layer="POINTER",this._item.name="Pointer"}color(t){return this._color=t,this.self()}radius(t){return this._radius=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"POINTER",color:this._color,radius:this._radius})}};var Et=class extends m{constructor(t){super(t),this._startPosition={x:0,y:0},this._endPosition={x:0,y:0},this._measurement="",this._item.layer="RULER",this._item.name="Ruler",this._style={variant:"FILLED"}}startPosition(t){return this._startPosition=t,this.self()}endPosition(t){return this._endPosition=t,this.self()}measurement(t){return this._measurement=t,this.self()}variant(t){return this._style.variant=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"RULER",startPosition:this._startPosition,endPosition:this._endPosition,measurement:this._measurement,style:this._style})}};var Ot=class extends m{constructor(t){super(t),this._width=0,this._height=0,this._shapeType="RECTANGLE",this._style={fillColor:"black",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:5,strokeDash:[]},this._item.layer="DRAWING",this._item.name="Shape"}width(t){return this._width=t,this.self()}height(t){return this._height=t,this.self()}shapeType(t){return this._shapeType=t,this.self()}style(t){return this._style=t,this.self()}fillColor(t){return this._style.fillColor=t,this.self()}fillOpacity(t){return this._style.fillOpacity=t,this.self()}strokeColor(t){return this._style.strokeColor=t,this.self()}strokeOpacity(t){return this._style.strokeOpacity=t,this.self()}strokeWidth(t){return this._style.strokeWidth=t,this.self()}strokeDash(t){return this._style.strokeDash=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"SHAPE",width:this._width,height:this._height,shapeType:this._shapeType,style:this._style})}};var gt=class extends m{constructor(t){super(t),this._text={richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:0,fontFamily:"Roboto",fontSize:16,fontWeight:400,textAlign:"LEFT",textAlignVertical:"TOP",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"RICH",width:"AUTO",height:"AUTO"},this._item.layer="TEXT",this._item.name="Text"}text(t){return this._text=t,this.self()}width(t){return this._text.width=t,this.self()}height(t){return this._text.height=t,this.self()}richText(t){return this._text.richText=t,this.self()}plainText(t){return this._text.plainText=t,this.self()}textType(t){return this._text.type=t,this.self()}padding(t){return this._text.style.padding=t,this.self()}fontFamily(t){return this._text.style.fontFamily=t,this.self()}fontSize(t){return this._text.style.fontSize=t,this.self()}fontWeight(t){return this._text.style.fontWeight=t,this.self()}textAlign(t){return this._text.style.textAlign=t,this.self()}textAlignVertical(t){return this._text.style.textAlignVertical=t,this.self()}fillColor(t){return this._text.style.fillColor=t,this.self()}fillOpacity(t){return this._text.style.fillOpacity=t,this.self()}strokeColor(t){return this._text.style.strokeColor=t,this.self()}strokeOpacity(t){return this._text.style.strokeOpacity=t,this.self()}strokeWidth(t){return this._text.style.strokeWidth=t,this.self()}lineHeight(t){return this._text.style.lineHeight=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"TEXT",text:this._text})}};var vt=class extends m{constructor(t){super(t),this._commands=[],this._fillRule="nonzero",this._style={fillColor:"black",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:5,strokeDash:[]},this._item.name="Path",this._item.layer="DRAWING"}commands(t){return this._commands=t,this.self()}fillRule(t){return this._fillRule=t,this.self()}style(t){return this._style=t,this.self()}fillColor(t){return this._style.fillColor=t,this.self()}fillOpacity(t){return this._style.fillOpacity=t,this.self()}strokeColor(t){return this._style.strokeColor=t,this.self()}strokeOpacity(t){return this._style.strokeOpacity=t,this.self()}strokeWidth(t){return this._style.strokeWidth=t,this.self()}strokeDash(t){return this._style.strokeDash=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"PATH",commands:this._commands,fillRule:this._fillRule,style:this._style})}};var xt=class{constructor(t){this._upload={file:t,grid:{dpi:150,offset:{x:0,y:0}},name:"",rotation:0,scale:{x:1,y:1},text:{richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:8,fontFamily:"Roboto",fontSize:24,fontWeight:400,textAlign:"CENTER",textAlignVertical:"BOTTOM",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"PLAIN",width:"AUTO",height:"AUTO"},locked:!1,textItemType:"LABEL",visible:!0}}grid(t){return this._upload.grid=t,this}dpi(t){return this._upload.grid.dpi=t,this}offset(t){return this._upload.grid.offset=t,this}name(t){return this._upload.name=t,this}description(t){return this._upload.description=t,this}rotation(t){return this._upload.rotation=t,this}scale(t){return this._upload.scale=t,this}locked(t){return this._upload.locked=t,this}visible(t){return this._upload.visible=t,this}text(t){return this._upload.text=t,this}textItemType(t){return this._upload.textItemType=t,this}textWidth(t){return this._upload.text.width=t,this}textHeight(t){return this._upload.text.height=t,this}richText(t){return this._upload.text.richText=t,this}plainText(t){return this._upload.text.plainText=t,this}textType(t){return this._upload.text.type=t,this}textPadding(t){return this._upload.text.style.padding=t,this}fontFamily(t){return this._upload.text.style.fontFamily=t,this}fontSize(t){return this._upload.text.style.fontSize=t,this}fontWeight(t){return this._upload.text.style.fontWeight=t,this}textAlign(t){return this._upload.text.style.textAlign=t,this}textAlignVertical(t){return this._upload.text.style.textAlignVertical=t,this}textFillColor(t){return this._upload.text.style.fillColor=t,this}textFillOpacity(t){return this._upload.text.style.fillOpacity=t,this}textStrokeColor(t){return this._upload.text.style.strokeColor=t,this}textStrokeOpacity(t){return this._upload.text.style.strokeOpacity=t,this}textStrokeWidth(t){return this._upload.text.style.strokeWidth=t,this}textLineHeight(t){return this._upload.text.style.lineHeight=t,this}build(){return this._upload}};var Tt=class{constructor(){this._upload={name:"New Scene",fog:{filled:!1,style:{color:"#222222",strokeWidth:5}},grid:{dpi:150,scale:"5ft",style:{lineColor:"LIGHT",lineOpacity:.4,lineType:"DASHED"},measurement:"CHEBYSHEV",type:"SQUARE"},items:[]}}name(t){return this._upload.name=t,this}fogFilled(t){return this._upload.fog.filled=t,this}fogColor(t){return this._upload.fog.style.color=t,this}fogStrokeWidth(t){return this._upload.fog.style.strokeWidth=t,this}gridScale(t){return this._upload.grid.scale=t,this}gridColor(t){return this._upload.grid.style.lineColor=t,this}gridOpacity(t){return this._upload.grid.style.lineOpacity=t,this}gridLineType(t){return this._upload.grid.style.lineType=t,this}gridMeasurement(t){return this._upload.grid.measurement=t,this}gridType(t){return this._upload.grid.type=t,this}items(t){return this._upload.items=t,this}baseMap(t){return this._upload.baseMap=t,this}thumbnail(t){return this._upload.thumbnail=t,this}build(){return this._upload}};var fe=typeof Buffer=="function",di=typeof TextDecoder=="function"?new TextDecoder:void 0,Xs=typeof TextEncoder=="function"?new TextEncoder:void 0,Qi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",tn=Array.prototype.slice.call(Qi),At=(i=>{let t={};return i.forEach((e,n)=>t[e]=n),t})(tn),en=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,G=String.fromCharCode.bind(String),fi=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):i=>new Uint8Array(Array.prototype.slice.call(i,0));var _i=i=>i.replace(/[^A-Za-z0-9\+\/]/g,"");var nn=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,sn=i=>{switch(i.length){case 4:var t=(7&i.charCodeAt(0))<<18|(63&i.charCodeAt(1))<<12|(63&i.charCodeAt(2))<<6|63&i.charCodeAt(3),e=t-65536;return G((e>>>10)+55296)+G((e&1023)+56320);case 3:return G((15&i.charCodeAt(0))<<12|(63&i.charCodeAt(1))<<6|63&i.charCodeAt(2));default:return G((31&i.charCodeAt(0))<<6|63&i.charCodeAt(1))}},rn=i=>i.replace(nn,sn),on=i=>{if(i=i.replace(/\s+/g,""),!en.test(i))throw new TypeError("malformed base64.");i+="==".slice(2-(i.length&3));let t,e,n,s=[];for(let r=0;r<i.length;)t=At[i.charAt(r++)]<<18|At[i.charAt(r++)]<<12|(e=At[i.charAt(r++)])<<6|(n=At[i.charAt(r++)]),e===64?s.push(G(t>>16&255)):n===64?s.push(G(t>>16&255,t>>8&255)):s.push(G(t>>16&255,t>>8&255,t&255));return s.join("")},pi=typeof atob=="function"?i=>atob(_i(i)):fe?i=>Buffer.from(i,"base64").toString("binary"):on,un=fe?i=>fi(Buffer.from(i,"base64")):i=>fi(pi(i).split("").map(t=>t.charCodeAt(0)));var an=fe?i=>Buffer.from(i,"base64").toString("utf8"):di?i=>di.decode(un(i)):i=>rn(pi(i)),cn=i=>_i(i.replace(/[-_]/g,t=>t=="-"?"+":"/")),yi=i=>an(cn(i));function mi(){let t=new URLSearchParams(window.location.search).get("obrref"),e="",n="";if(t){let r=yi(t).split(" ");r.length===2&&(e=r[0],n=r[1])}return{origin:e,roomId:n}}function Qs(i){return i.type==="CURVE"}function er(i){return i.type==="IMAGE"}function nr(i){return i.type==="LABEL"}function rr(i){return i.type==="LINE"}function ur(i){return i.type==="POINTER"}function cr(i){return i.type==="RULER"}function hr(i){return i.type==="SHAPE"}function fr(i){return i.type==="TEXT"}var Ei;(function(i){i[i.MOVE=0]="MOVE",i[i.LINE=1]="LINE",i[i.QUAD=2]="QUAD",i[i.CONIC=3]="CONIC",i[i.CUBIC=4]="CUBIC",i[i.CLOSE=5]="CLOSE"})(Ei||(Ei={}));function pr(i){return i.type==="PATH"}function _e(i,t){return Math.round(i/t)*t}function pe(i,t){return Math.floor(i/t)*t}function tt(i){return i*(Math.PI/180)}function Oi(i){return i*(180/Math.PI)}function ye(i,t,e){return i*(1-e)+t*e}var gi=class{static magnitudeSquared(t){return t.x*t.x+t.y*t.y}static magnitude(t){let e=Math.sqrt(this.magnitudeSquared(t));return isNaN(e)?0:e}static normalize(t){let e=this.magnitude(t);return e===0?{x:0,y:0}:this.divide(t,e)}static dot(t,e){return t.x*e.x+t.y*e.y}static subtract(t,e){return typeof e=="number"?{x:t.x-e,y:t.y-e}:{x:t.x-e.x,y:t.y-e.y}}static add(t,e){return typeof e=="number"?{x:t.x+e,y:t.y+e}:{x:t.x+e.x,y:t.y+e.y}}static multiply(t,e){return typeof e=="number"?{x:t.x*e,y:t.y*e}:{x:t.x*e.x,y:t.y*e.y}}static divide(t,e){return typeof e=="number"?{x:t.x/e,y:t.y/e}:{x:t.x/e.x,y:t.y/e.y}}static rotate(t,e,n){let s=Math.cos(tt(n)),r=Math.sin(tt(n)),o=this.subtract(t,e);return{x:e.x+s*o.x-r*o.y,y:e.y+r*o.x+s*o.y}}static min(t,e){return typeof e=="number"?{x:Math.min(t.x,e),y:Math.min(t.y,e)}:{x:Math.min(t.x,e.x),y:Math.min(t.y,e.y)}}static componentMin(t){return t.x<t.y?t.x:t.y}static max(t,e){return typeof e=="number"?{x:Math.max(t.x,e),y:Math.max(t.y,e)}:{x:Math.max(t.x,e.x),y:Math.max(t.y,e.y)}}static componentMax(t){return t.x>t.y?t.x:t.y}static roundTo(t,e){return{x:_e(t.x,e.x),y:_e(t.y,e.y)}}static floorTo(t,e){return{x:pe(t.x,e.x),y:pe(t.y,e.y)}}static sign(t){return{x:Math.sign(t.x),y:Math.sign(t.y)}}static abs(t){return{x:Math.abs(t.x),y:Math.abs(t.y)}}static pow(t,e){return typeof e=="number"?{x:Math.pow(t.x,e),y:Math.pow(t.y,e)}:{x:Math.pow(t.x,e.x),y:Math.pow(t.y,e.y)}}static clamp(t,e,n){return{x:Math.min(Math.max(t.x,e),n),y:Math.min(Math.max(t.y,e),n)}}static boundingBox(t){let e=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(let a of t)e=a.x<e?a.x:e,n=a.x>n?a.x:n,s=a.y<s?a.y:s,r=a.y>r?a.y:r;let o=n-e,h=r-s,l={x:(e+n)/2,y:(s+r)/2};return{min:{x:e,y:s},max:{x:n,y:r},width:o,height:h,center:l}}static pointInPolygon(t,e){let n=this.boundingBox(e);if(t.x<n.min.x||t.x>n.max.x||t.y<n.min.y||t.y>n.max.y)return!1;let s=!1;for(let r=0,o=e.length-1;r<e.length;o=r++){let h=e[r].y>t.y,l=e[o].y>t.y;h!==l&&t.x<(e[o].x-e[r].x)*(t.y-e[r].y)/(e[o].y-e[r].y)+e[r].x&&(s=!s)}return s}static compare(t,e,n){return this.magnitudeSquared(this.subtract(t,e))<n*n}static distance(t,e){return this.magnitude(this.subtract(t,e))}static lerp(t,e,n){return{x:ye(t.x,e.x,n),y:ye(t.y,e.y,n)}}static centroid(t){let e={x:0,y:0};for(let n of t)e.x+=n.x,e.y+=n.y;return t.length>0&&(e={x:e.x/t.length,y:e.y/t.length}),e}};var vi=class i{static inverse(t){let[e,n,s,r,o,h,l,a,u]=t,c=e*(o*u-a*h)-n*(r*u-h*l)+s*(r*a-o*l);if(Math.abs(c)<1e-14)return t;let d=1/c,f=(o*u-a*h)*d,p=(s*a-n*u)*d,y=(n*h-s*o)*d,v=(h*l-r*u)*d,x=(e*u-s*l)*d,T=(r*s-e*h)*d,b=(r*a-l*o)*d,Bt=(l*n-e*a)*d,et=(e*o-r*n)*d;return[f,p,y,v,x,T,b,Bt,et]}static multiply(t,e){return[t[0]*e[0]+t[1]*e[3]+t[2]*e[6],t[0]*e[1]+t[1]*e[4]+t[2]*e[7],t[0]*e[2]+t[1]*e[5]+t[2]*e[8],t[3]*e[0]+t[4]*e[3]+t[5]*e[6],t[3]*e[1]+t[4]*e[4]+t[5]*e[7],t[3]*e[2]+t[4]*e[5]+t[5]*e[8],t[6]*e[0]+t[7]*e[3]+t[8]*e[6],t[6]*e[1]+t[7]*e[4]+t[8]*e[7],t[6]*e[2]+t[7]*e[5]+t[8]*e[8]]}static fromPosition(t){return[1,0,t.x,0,1,t.y,0,0,1]}static fromRotation(t){let e=tt(t);return[Math.cos(e),-Math.sin(e),0,Math.sin(e),Math.cos(e),0,0,0,1]}static fromScale(t){return[t.x,0,0,0,t.y,0,0,0,1]}static fromItem(t){let e=i.fromPosition(t.position),n=i.fromScale(t.scale),s=i.fromRotation(t.rotation);return i.multiply(i.multiply(e,s),n)}static decompose(t){let[e,n,s,r,o,h]=t,l=e*o-r*n,a={position:{x:s,y:h},rotation:0,scale:{x:1,y:1}};if(e!=0||r!=0){var u=Math.sqrt(e*e+r*r);a.rotation=r>0?Math.acos(e/u):-Math.acos(e/u),a.scale={x:u,y:l/u}}else if(n!=0||o!=0){var c=Math.sqrt(n*n+o*o);a.rotation=Math.PI/2-(o>0?Math.acos(-n/c):-Math.acos(n/c)),a.scale={x:l/c,y:c}}return a.rotation=Oi(a.rotation),a}};var me=mi(),E=new De(me.origin,me.roomId),ln=new ge(E),M=new Oe(E),hn=new ui(E),dn=new ke(E),fn=new qe(E),_n=new ti(E),pn=new ei(E),yn=new ii(E),mn=new si(E),En=new ri(E),On=new oi(E),gn=new ai(E),vn=new ci(E),xn=new li(E),Tn=new hi(E),An={onReady:i=>{E.ready?i():E.once("OBR_READY",()=>i())},get isReady(){return E.ready},viewport:ln,player:M,party:hn,notification:dn,scene:fn,contextMenu:_n,tool:pn,popover:yn,modal:mn,action:En,interaction:On,room:gn,theme:vn,assets:xn,broadcast:Tn,isAvailable:!!me.origin};function Mo(){return new ft(M)}function bo(i,t){return new _t(M,i,t)}function Lo(){return new pt(M)}function Do(){return new yt(M)}function Po(){return new mt(M)}function ko(){return new Et(M)}function Uo(){return new Ot(M)}function Go(){return new gt(M)}function Vo(){return new vt(M)}function jo(i){return new xt(i)}function Wo(){return new Tt}var Ho=An;export{Ei as Command,gi as Math2,vi as MathM,Mo as buildCurve,bo as buildImage,jo as buildImageUpload,Lo as buildLabel,Do as buildLine,Vo as buildPath,Po as buildPointer,ko as buildRuler,Wo as buildSceneUpload,Uo as buildShape,Go as buildText,Ho as default,Qs as isCurve,er as isImage,nr as isLabel,rr as isLine,pr as isPath,ur as isPointer,cr as isRuler,hr as isShape,fr as isText};
